{% extends "base.html" %}

{% block title %}Add item Â· Indexd{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-8 col-lg-7">
    <h1 class="h3 mb-3 fw-semibold">Add an item</h1>

    <p class="text-secondary mb-4">
      Search external catalogs or enter details manually, then drop it into one of your lists.
    </p>

    <form method="post" novalidate>
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="alert alert-danger">
          {{ form.non_field_errors }}
        </div>
      {% endif %}

      <!-- Search section -->
      <div class="card mb-4">
        <div class="card-body">
          <h2 class="h6 mb-3">Quick search</h2>
          <div class="row g-2 align-items-end">
            <div class="col-md-4">
              <label class="form-label" for="search_item_type">Category</label>
              <select id="search_item_type" name="search_item_type" class="form-select">
                <option value="movie">Movie / TV / Anime</option>
                <option value="book">Book</option>
                <!-- later: add other types when we support APIs -->
              </select>
            </div>
            <div class="col-md-6">
              <label class="form-label" for="search_query">Search</label>
              <input type="text" id="search_query" name="search_query" class="form-control"
                     placeholder="Type a title or keyword">
            </div>
            <div class="col-md-2 d-grid">
              <button
                type="button"
                class="btn btn-outline-dark"
                hx-get="{% url 'catalog:external_search' %}"
                hx-target="#search-results"
                hx-swap="innerHTML"
                hx-include="#search_item_type, #search_query"
              >
                Search
              </button>
            </div>
          </div>

          <div id="search-results" class="mt-3 small text-secondary">
            <p class="mb-0">Results will appear here. You can then choose one to fill the fields below.</p>
          </div>
        </div>
      </div>

      <!-- Item fields container (HTMX will swap this) -->
      <div id="item-fields">
        {% include "catalog/partials/item_fields_prefilled.html" with title="" item_type="movie" url="" thumbnail_url="" %}
      </div>

      <hr class="my-4">

      <h2 class="h6 mb-3">Add to a list</h2>

      <div class="mb-3">
        <label class="form-label" for="{{ form.list.id_for_label }}">Existing list</label>
        {{ form.list }}
        {% if not form.list.field.queryset %}
          <div class="form-text">
            You don't have any lists yet. You can create one below.
          </div>
        {% endif %}
      </div>

      <div class="mb-3">
        <label class="form-label" for="{{ form.new_list_title.id_for_label }}">New list title</label>
        {{ form.new_list_title }}
        <div class="form-text">
          If you enter a title here, a new list will be created and this item will be added to it.
        </div>
      </div>

      <div class="form-check mb-4">
        {{ form.new_list_is_public }}
        <label class="form-check-label" for="{{ form.new_list_is_public.id_for_label }}">
          Make new list public
        </label>
      </div>

      <button type="submit" class="btn btn-primary">
        Save item
      </button>
    </form>
  </div>
</div>
{% endblock %}
